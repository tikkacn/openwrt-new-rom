name: 拆包编译

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

env:
  REPO_URL: https://github.com/coolsnowwolf/lede
  REPO_BRANCH: master
  TZ: Asia/Shanghai

jobs:
  build-toolchain:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Initialize Environment
      env:
        DEBIAN_FRONTEND: noninteractive
      run: |
        sudo rm -rf /etc/apt/sources.list.d/* /usr/share/dotnet /usr/local/lib/android /opt/ghc
        sudo -E apt-get -qq update
        sudo -E apt-get -qq install \
          build-essential clang flex bison g++ gawk gcc-multilib g++-multilib \
          gettext git libncurses5-dev libssl-dev python3-distutils \
          libncurses5-dev zlib1g-dev libelf-dev lib32gcc-s1 \
          rsync unzip file wget python3 python3-pip python3-ply \
          qemu-utils upx libstring-crc32-perl antlr3 gperf \
          libantlr3c-dev ccache help2man python3-dev \
          xsltproc
        sudo -E apt-get -qq autoremove --purge
        sudo -E apt-get -qq clean
        sudo timedatectl set-timezone "$TZ"

    - name: Clone Source Code
      run: |
        git clone $REPO_URL -b $REPO_BRANCH openwrt
        cd openwrt
        sed -i 's/192.168.1.1/192.168.2.1/g' package/base-files/files/bin/config_generate
        ./scripts/feeds update -a
        ./scripts/feeds install -a

    # ... 其余步骤保持不变 ...
